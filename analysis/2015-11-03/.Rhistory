source("http://www.bioconductor.org/biocLite.R")
biocLite()
pgkInstall('synapseClient')
install.packages('synapseClient')
source("http://depot.sagebase.org/CRAN.R")
pkgInstall('synapseClient')
pkgInstall('RCurl')
pkgInstall('rjson')
pkgInstall('digest')
pkgInstall('RUnit')
install.packages('devtools')
library(devtools)
install_github("vqv/ggbiplot")
q()
source("http://www.bioconductor.org/biocLite.R")
biocLite('DNAcopy')
library(DNAcopy)
library(CNTools)
biocLite('CNTools')
library(CNTools)
?subset.CNA
q()
q()
setwd('Code/NTAP/pnfCellLines/analysis/2015-11-02/')
library(synapseClient)
#first login to synapse
synapseLogin()
snpfiles=synapseQuery('SELECT id,name FROM entity where parentId=="syn4988794"')
head(snpfiles)
snpfiles=synapseQuery('SELECT id,sampleName,sampleGenotype,sampleID,sampleOrigin FROM entity where parentId=="syn4988794"')
head(snpfiles)
bindir=dirname(sys.frame(1)$ofile)
sys
library(sys)
sys.frames()
geneInfo<-read.table('../../data/hg19_geneInfo.txt')
segdata2 <- read.table(synGet('syn5015036')@filePath,header=T)
head(segdata2)
unique(segdata2)
unique(segdata2[,1])
head(synapseFileServiceEndpoint())
head(snpfiles)
source('../../bin/clusterCNVBySample.R')
plotClusteredSegmentData(segdata2,'gene','median',100)
source('../../bin/clusterCNVBySample.R')
plotClusteredSegmentData(segdata2,'gene','median',100)
origin<-snpfiles$'entity.sampleOrigin'
names(origin)<-snpfiles$entity.sampleID
clnames<-snpfiles$'entity.sampleName'
names(clnames)<-snpfiles$entity.sampleID
clnames
plotClusteredSegmentData(segdata2,'gene','median',100)
genotype<-snpfiles$'entity.sampleGenotype'
names(genotype)<-clnames
source('../../bin/clusterCNVBySample.R')
plotClusteredSegmentData(segdata2,'gene','median',100)
snpfiles
origin<-snpfiles$'entity.sampleOrigin'
names(origin)<-snpfiles$entity.sampleID
clnames<-paste(snpfiles$'entity.sampleName',snpfiles$'entity.sampleGenotype')
names(clnames)<-snpfiles$entity.sampleID
genotype<-snpfiles$'entity.sampleGenotype'
names(genotype)<-clnames
genotype
clnames
genotype
colnames(M)
source('../../bin/clusterCNVBySample.R')
source('../../bin/clusterCNVBySample.R')
plotClusteredSegmentData(segdata2,'gene','median',100)
plotClusteredSegmentData(segdata2,'region','median',100)
segdat<-segdata2
cnseg <- CNSeg(segdat)
byval='region'
rdseg <- getRS(cnseg, by = byval, imput = FALSE, XY = FALSE, what = metric)
segM <- rs(rdseg)
col.inds=4:ncol(segM)
library(CNTools)
rdseg <- getRS(cnseg, by = byval, imput = FALSE, XY = FALSE, what = metric)
segM <- rs(rdseg)
col.inds=4:ncol(segM)
metric='median'
rdseg <- getRS(cnseg, by = byval, imput = FALSE, XY = FALSE, what = metric)
segM <- rs(rdseg)
col.inds=4:ncol(segM)
col.inds
M <- t(do.call("rbind", lapply(col.inds, function(i) as.numeric(as.character(segM[,i])))))
#    idxs <- match(colnames(segM)[col.inds], sample.names)
colnames(M)<-colnames(segM)[col.inds]
head(M)
allvars<-apply(M,1,var,na.rm=T)
allvars
if(length(which(allvars==0))>0){
M<-M[-which(allvars==0),]
allvars=allvars[-which(allvars==0)]
}
tm<-M
pc=prcomp(t(tm),scale.=T,center.=T)
gb<-ggbiplot(pc,groups=as.factor(origin[colnames(M)]),choices=1:2,obs.scale=1,var.scale=1,ellipse=TRUE,var.axes=FALSE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
print(gb)
dev.off()
origin
head(tm)
pc$x
gb<-ggbiplot(pc,groups=as.factor(origin[colnames(M)]),choices=1:2,obs.scale=1,var.scale=1,ellipse=TRUE,var.axes=FALSE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
print(gb)
colnames(tm) <- clnames[colnames(tm)]
plot(hclust(dist(t(tm)),method="ward.D2"),main="Clustering of samples based on distance")
tm=M[order(allvars,decreasing=T)[1:100],]
dim(tm)
head(tm)
nfcor=rep(0,nrow(M))
nfcor=rep(0,nrow(M))
pc=prcomp(t(tm),scale.=T,center.=T)
gb<-ggbiplot(pc,groups=as.factor(origin[colnames(M)]),choices=1:2,obs.scale=1,var.scale=1,ellipse=TRUE,var.axes=FALSE) +
scale_color_discrete(name = '') +
theme(legend.direction = 'horizontal', legend.position = 'top')
prin(gb)
print(gb)
plot(hclust(dist(t(tm)),method="ward.D2"),main="Clustering of samples based on distance")
plot(hclust(dist(t(tm)),method="ward.D2"),main="Clustering of samples based on distance")
print(gb)
plot(hclust(dist(t(tm)),method="ward.D2"),main="Clustering of samples based on distance")
colnames(tm) <- clnames[colnames(tm)]
plot(hclust(dist(t(tm)),method="ward.D2"),main="Clustering of samples based on distance")
pheatmap(tm,annotation_row=data.frame(NF1Corr=nfcor),
annotation_col=data.frame(Genotype=genotype),cellwidth=10,cellheight=10,file=fname)
pheatmap(tm,annotation_row=data.frame(NF1Corr=nfcor),
annotation_col=data.frame(Genotype=genotype),cellwidth=10,cellheight=10)
head(tm)
pheatmap(tm,annotation_col=data.frame(Genotype=genotype),cellwidth=10,cellheight=10)
source('../../bin/clusterCNVBySample.R')
main()
source('../../bin/clusterCNVBySample.R')
main()
source('../../bin/clusterCNVBySample.R')
main()
source('../../bin/clusterCNVBySample.R')
main()
snpfiles<<-synapseQuery('SELECT id,sampleName,sampleGenotype,sampleID,sampleOrigin FROM entity where parentId=="syn4988794"')
#now get annotations
origin<<-snpfiles$'entity.sampleOrigin'
names(origin)<<-snpfiles$entity.sampleID
origin
snpfiles
snpfiles<<-synapseQuery('SELECT id,sampleName,sampleGenotype,sampleID,sampleOrigin FROM entity where parentId=="syn4988794"')
#now get annotations
origin<<-snpfiles$'entity.sampleOrigin'
names(origin)<<-snpfiles$entity.sampleID
clnames<<-paste(snpfiles$'entity.sampleName',snpfiles$'entity.sampleGenotype')
names(clnames)<<-snpfiles$entity.sampleID
source('../../bin/clusterCNVBySample.R')
main()
source('../../bin/clusterCNVBySample.R')
main()
source('../../bin/clusterCNVBySample.R')
main()
source('../../bin/clusterCNVBySample.R')
main()
filelist=list(list(name='clusterCNVBySample.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/clusterCNVBySample.R',wasExecuted=TRUE),list(entity='syn5015036',wasExecuted=FALSE),list(name='CNVData.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/CNVData.R',wasExecuted=TRUE))
#image 1 - unsupervised clustering
sf=File('all_gene_by_median_logRRatios_dendro.png',parentId=parentid)
#add annotations
#add in activity
synStore(sf,used=filelist,activityName='Plotting of all segmented CNV data',
activityDescription='To execute source clusterCNVBySample.R and then run main()')
filelist=list(list(name='clusterCNVBySample.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/clusterCNVBySample.R',wasExecuted=TRUE),list(entity='syn5015036',wasExecuted=FALSE),list(name='CNVData.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/CNVData.R',wasExecuted=TRUE))
#image 1 - unsupervised clustering
sf=File('all_gene_by_median_logRRatios_dendro.png',parentId=parentid)
#add annotations
#add in activity
synStore(sf,used=filelist,activityName='Plotting of all segmented CNV data',
activityDescription='To execute source clusterCNVBySample.R and then run main()')
parentparentid='syn5014748'
#here are the files used for the analysis performed
filelist=list(list(name='clusterCNVBySample.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/clusterCNVBySample.R',wasExecuted=TRUE),list(entity='syn5015036',wasExecuted=FALSE),list(name='CNVData.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/CNVData.R',wasExecuted=TRUE))
#image 1 - unsupervised clustering
sf=File('all_gene_by_median_logRRatios_dendro.png',parentId=parentid)
#add annotations
#add in activity
synStore(sf,used=filelist,activityName='Plotting of all segmented CNV data',
activityDescription='To execute source clusterCNVBySample.R and then run main()')
#im
parentid='syn5014748'
#here are the files used for the analysis performed
filelist=list(list(name='clusterCNVBySample.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/clusterCNVBySample.R',wasExecuted=TRUE),list(entity='syn5015036',wasExecuted=FALSE),list(name='CNVData.R',url='https://raw.githubusercontent.com/sgosline/NTAP/master/pnfCellLines/bin/CNVData.R',wasExecuted=TRUE))
#image 1 - unsupervised clustering
sf=File('all_gene_by_median_logRRatios_dendro.png',parentId=parentid)
#add annotations
#add in activity
synStore(sf,used=filelist,activityName='Plotting of all segmented CNV data',
activityDescription='To execute source clusterCNVBySample.R and then run main()')
#im
sf=File('most_variable_100_gene_by_median_logRRatios_heatmap.png',parentId=parentid)
#add annotations
#add in activity
synStore(sf,used=filelist,activityName='Plotting of genes with most variable CNAs',
activityDescription='To execute source clusterCNVBySample.R and then run main()')
#image 3 - correlated by genotype
sf=File('most_gt_correlated_100_gene_by_median_logRRatios_heatmap.png',parentId=parentid)
#add annotations
#add in activity
synStore(sf,used=filelist,activityName=
'Plotting of genes with CNAs that correlate with genotype',
activityDescription
='To execute source clusterCNVBySample.R and then run main()')
snpfiles=synapseQuery('SELECT id,name,Patient_ID,Tissue_Type,Tissue_ID FROM entity where parentId=="syn5004874"')
snpfiles
snpfiles=synapseQuery('SELECT id,name,PatientID,tissueType,tissueID FROM entity where parentId=="syn5004874"')
snpfiles
head(snpfiles)
snpfiles=synapseQuery('SELECT id,name,patientID,tissueType,tissueID FROM entity where parentId=="syn5004874"')
head(snpfiles)
setwd('../../../../dermalNF/analysis/2015-11-03/')
source("../../bin/dermalNFData.R")
snpfiles=synapseQuery('SELECT id,name,patientID,tissueType,tissueID FROM entity where parentId=="syn5004874"')
head(snpfiles)
snp.tissue<-snpfiles$tissueID
snp.tissue
source("../../bin/dermalNFData.R")
annot <- snp_annotation_data()
